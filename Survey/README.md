# Survey Backend

## Описание

Данный проект — это backend-сервис для сбора и анализа опросов, написанный на ASP.NET Core с использованием PostgreSQL. В комплекте также присутствует Grafana для мониторинга. Все сервисы запускаются через Docker Compose.

---

## Требования

- Docker
- Docker Compose

---

## Быстрый старт

1. **Клонируйте репозиторий или получите архив с проектом.**

2. **Перейдите в корневую папку проекта:**
   ```sh
   cd путь/до/папки/с/проектом
   ```

3. **Проверьте, что в корне проекта есть файлы:**
   - `Dockerfile`
   - `docker-compose.yml`

4. **Запустите сборку:**
   ```sh
   docker-compose up --build
   ```
   Это автоматически соберёт backend, поднимет базу данных PostgreSQL и Grafana.

5. **Доступ к сервисам:**
   - Backend будет доступен по адресу: [http://localhost:17311](http://localhost:17311)
   - Grafana будет доступна по адресу: [http://localhost:17303](http://localhost:17303) (логин/пароль по умолчанию: admin/admin)
   - PostgreSQL будет доступен внутри docker-сети как `quest-postgres:5432` (логин: postgres, пароль: quest-system, база: quest)

6. **Остановка сервисов:**
   ```sh
   docker-compose down
   ```

---

## Переменные окружения

Все необходимые переменные окружения уже прописаны в `docker-compose.yml`. Если требуется изменить адреса сервисов или параметры подключения к БД, отредактируйте соответствующие строки в этом файле.

- `REST_API_AI_AGENT_ANALYZE_FULL_ADDRESS` и `REST_API_AI_AGENT_ANALYZE_PARAMETER_ADDRESS` — адреса внешнего AI-агента (настраиваются отдельно, сервис не входит в этот compose).
- `POSTGRES_ADDRESS` — строка подключения к базе данных PostgreSQL.
- `ASPNETCORE_ENVIRONMENT` — окружение ASP.NET Core (по умолчанию Development).

---

## Структура проекта

- `Survey.Api` — основной backend-сервис (ASP.NET Core)
- `Survey.EntityFramework` — миграции и контекст базы данных
- `Survey.ServiceDefaults` — общие модели, DTO и константы

---

## Сборка и запуск вручную (без Docker)

1. Установите .NET 9.0 SDK и PostgreSQL 15+.
2. В файле `Survey.Api/appsettings.json` или через переменные окружения укажите параметры подключения к вашей базе данных и AI-агенту.
3. Выполните миграции базы данных.
4. Соберите и запустите проект командой:
   ```sh
   dotnet build
   dotnet run --project Survey.Api/Survey.Api.csproj
   ```

---

## Важно

- Для работы с AI-агентом требуется внешний сервис, который не входит в данный docker-compose. Адреса для интеграции настраиваются через переменные окружения.
- Все переменные окружения для интеграции сервисов уже настроены для работы "из коробки".
- Grafana предназначена для мониторинга и может быть дополнительно настроена под ваши нужды.

---

## Автор

**Кольчиков Евгений Олегович**  
Программист-разработчик по интеграции информационных систем 
KolchikovEO@sinara-group.com